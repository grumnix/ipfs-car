'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var sha2 = require('multiformats/hashes/sha2');
var murmur3 = require('@multiformats/murmur3');
var blake2b = require('@multiformats/blake2/blake2b');
var blake2s = require('@multiformats/blake2/blake2s');
var sha3 = require('@multiformats/sha3');
var uint8arrays = require('uint8arrays');

const hashMap = new Map([
  sha2.sha256,
  sha2.sha512,
  murmur3.murmur3128,
  murmur3.murmur332,
  blake2b.blake2b256,
  blake2s.blake2s256,
  sha3.sha3224,
  sha3.sha3256,
  sha3.sha3384,
  sha3.sha3512,
  sha3.shake128,
  sha3.shake256,
  sha3.keccak224,
  sha3.keccak256,
  sha3.keccak384,
  sha3.keccak512
].map(hash => [
  hash.code,
  hash
]));
async function validateBlock(block) {
  const hasher = hashMap.get(block.cid.multihash.code);
  if (!hasher) {
    throw new Error(`multihash code ${ block.cid.multihash.code } is not supported`);
  }
  const bytesHash = await hasher.digest(block.bytes);
  if (!uint8arrays.equals(bytesHash.digest, block.cid.multihash.digest)) {
    throw new Error('CID hash does not match bytes');
  }
}

exports.hashMap = hashMap;
exports.validateBlock = validateBlock;
